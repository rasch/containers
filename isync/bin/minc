#!/bin/sh

MAILDIR="${MAILDIR:-$HOME/.config/xpod/mail}"

test -d "$MAILDIR" || {
  printf 'ERROR: [%s] MAILDIR path does not exist.\n' "$MAILDIR" >&2
  exit 1
}

entrypoint='["minc"]'

if ! test -t 0; then
  no_tty=true
  entrypoint='["xargs", "-r", "minc"]'
fi

xpod -${no_tty:+i}l -- \
  --entrypoint "$entrypoint" \
  --env COLORTERM \
  --env MBLAZE_PAGER=more \
  --env TERM \
  --volume "$MAILDIR":/root/mail \
  --workdir /root/mail \
  isync "$@"
